<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>مسابقة رمضان - أكاديمية HZ</title>

<style>
/* RESET */
*{
    margin:0;
    padding:0;
    box-sizing:border-box;
    font-family:"Cairo", sans-serif;
}

/* ===== خلفية رمضانية متحركة ===== */
body{
    overflow:hidden;
    background:radial-gradient(circle at top, #2c145a 0, #050010 55%, #000 100%);
    height:100vh;
    width:100vw;
    position:relative;
}

/* نجوم بسيطة */
.stars{
    position:absolute;
    width:100%;
    height:100%;
    background-image:
        radial-gradient(2px 2px at 20% 30%, #fff, transparent),
        radial-gradient(2px 2px at 80% 20%, #fff, transparent),
        radial-gradient(2px 2px at 60% 70%, #fff, transparent),
        radial-gradient(2px 2px at 30% 80%, #fff, transparent);
    opacity:0.6;
}


@keyframes twinkle{
    from{opacity:0.4;}
    to{opacity:1;}
}

/* فوانيس متحركة */
.lantern{
    position:absolute;
    width:120px;
    animation: float 6s ease-in-out infinite;
    opacity:0.9;
}

.lantern:nth-child(1){
    left:10%;
    top:5%;
    animation-duration:7s;
}
.lantern:nth-child(2){
    right:12%;
    top:15%;
    animation-duration:5.5s;
}
.lantern:nth-child(3){
    left:45%;
    top:8%;
    animation-duration:6.5s;
}

@keyframes float{
    0%{transform:translateY(0px);}
    50%{transform:translateY(25px);}
    100%{transform:translateY(0px);}
}

/* ===== شاشة إدخال الاسم ===== */
.username-screen{
    position:absolute;
    top:0;left:0;
    width:100%;height:100%;
    background:rgba(0,0,0,0.65);
    display:flex;
    justify-content:center;
    align-items:center;
    animation:fadeIn 1s ease;
}

.username-box{
    background:rgba(255,255,255,0.15);
    padding:30px;
    border-radius:20px;
    backdrop-filter:blur(10px);
    width:90%;
    max-width:350px;
    text-align:center;
    color:white;
    box-shadow:0 10px 30px rgba(0,0,0,0.5);
}

.username-box h2{
    margin-bottom:15px;
    font-size:1.6rem;
}

.username-box input{
    width:100%;
    padding:12px;
    border:none;
    border-radius:10px;
    margin-top:10px;
    font-size:1.1rem;
}

.username-box button{
    margin-top:15px;
    padding:12px 25px;
    font-size:1.2rem;
    background:#FFD700;
    color:#4a148c;
    border:none;
    border-radius:10px;
    cursor:pointer;
    font-weight:bold;
    transition:0.25s;
}

.username-box button:hover{
    transform:scale(1.08);
}

@keyframes fadeIn{
    from{opacity:0; transform:translateY(20px);}
    to{opacity:1; transform:translateY(0);}
}
</style>
</head>

<body>

<!-- خلفية النجوم -->
<div class="stars"></div>

<!-- فوانيس -->
<img src="lantern.png" class="lantern">
<img src="lantern.png" class="lantern">
<img src="lantern.png" class="lantern">

<!-- شاشة إدخال الاسم -->
<div class="username-screen" id="usernameScreen">
    <div class="username-box">
        <h2>أدخل اسمك للبدء</h2>
        <input type="text" id="usernameInput" placeholder="اكتب اسمك هنا">
        <button onclick="saveUsername()">متابعة</button>
    </div>
</div>
<!-- شاشة البداية -->
<div class="start-screen" id="startScreen" style="display:none;">
    <div class="start-box">
        <h1 class="title">مسابقة رمضان - أكاديمية HZ</h1>

        <button class="start-btn" onclick="startGame()">ابدأ اللعب</button>

        <a href="admin.html" class="admin-link">صفحة إدارة الأسئلة</a>
    </div>
</div>

<style>
/* ===== شاشة البداية ===== */
.start-screen{
    position:absolute;
    top:0;left:0;
    width:100%;height:100%;
    background:rgba(0,0,0,0.65);
    display:flex;
    justify-content:center;
    align-items:center;
    animation:fadeIn 1s ease;
}

.start-box{
    background:rgba(255,255,255,0.15);
    padding:35px;
    border-radius:20px;
    backdrop-filter:blur(10px);
    width:90%;
    max-width:400px;
    text-align:center;
    color:white;
    box-shadow:0 10px 30px rgba(0,0,0,0.5);
}

.title{
    font-size:2rem;
    margin-bottom:20px;
}

.start-btn{
    padding:15px 35px;
    font-size:1.4rem;
    background:#FFD700;
    color:#4a148c;
    border:none;
    border-radius:12px;
    cursor:pointer;
    font-weight:bold;
    transition:0.25s;
}

.start-btn:hover{
    transform:scale(1.1);
}

.admin-link{
    display:block;
    margin-top:15px;
    color:#FFD700;
    font-size:0.9rem;
    text-decoration:none;
}
.admin-link:hover{text-decoration:underline;}
</style>

<!-- شاشة اللعبة -->
<div class="game-card" id="gameCard" style="display:none;">

    <!-- المؤقّت -->
    <div class="timer-box">
        <span>الوقت المتبقي:</span>
        <span id="timer" class="timer">20</span>
    </div>

    <!-- معلومات -->
    <div class="stats-header">
        <div>السؤال: <span id="qnum">1</span></div>
        <div>النقاط: <span id="score">0</span></div>
    </div>

    <!-- السؤال -->
    <div class="question-box">
        <div id="q-txt" class="question-text">جاري التحميل...</div>
    </div>

    <!-- الأزرار -->
    <div class="choice-btns">
        <button id="ok-btn" class="btn-correct">صحيح</button>
        <button id="no-btn" class="btn-wrong">خاطئ</button>
    </div>

    <div id="feedback"></div>

</div>

<style>
/* ===== شاشة اللعبة ===== */
.game-card{
    position:absolute;
    top:50%;left:50%;
    transform:translate(-50%, -50%);
    width:90%;
    max-width:600px;
    padding:30px;
    border-radius:25px;
    background:rgba(255,255,255,0.15);
    backdrop-filter:blur(12px);
    border:1px solid rgba(255,255,255,0.3);
    box-shadow:0 20px 50px rgba(0,0,0,0.4);
    text-align:center;
    animation:fadeIn 1s ease;
}

.timer-box{
    background:rgba(0,0,0,0.4);
    padding:10px;
    border-radius:12px;
    color:#FFD700;
    font-size:1.3rem;
    margin-bottom:15px;
    font-weight:bold;
}

.timer{
    font-size:1.6rem;
    margin-right:5px;
}

.stats-header{
    display:flex;
    justify-content:space-between;
    background:rgba(255,255,255,0.2);
    padding:12px;
    border-radius:12px;
    color:white;
    font-weight:bold;
    margin-bottom:20px;
}

.question-box{
    min-height:140px;
    display:flex;
    justify-content:center;
    align-items:center;
}

.question-text{
    font-size:1.6rem;
    color:#fff;
    font-weight:bold;
    line-height:1.7;
    animation:fadeIn 0.8s ease;
}

.choice-btns{
    display:flex;
    justify-content:center;
    gap:20px;
    margin-top:15px;
}

.choice-btns button{
    width:150px;
    padding:14px;
    font-size:1.3rem;
    border-radius:50px;
    border:none;
    cursor:pointer;
    transition:0.25s;
    color:white;
    font-weight:bold;
}

.btn-correct{background:#2ecc71;}
.btn-wrong{background:#e74c3c;}

.choice-btns button:hover{
    transform:scale(1.08);
}

#feedback{
    height:40px;
    margin-top:10px;
    font-size:1.4rem;
    font-weight:bold;
}
</style>

<!-- شاشة النهاية -->
<div class="end-screen" id="endScreen" style="display:none;">
    <div class="certificate">
        <h2>شهادة إتمام الاختبار</h2>
        <p>الاسم: <span id="certName"></span></p>
        <p>الدرجة: <span id="certScore"></span></p>
        <p>النسبة: <span id="certPercent"></span>%</p>
    </div>

    <button class="restart-btn" onclick="restart()">إعادة اللعب</button>
</div>

<style>
/* ===== شاشة النهاية ===== */
.end-screen{
    position:absolute;
    top:0;left:0;
    width:100%;height:100%;
    background:rgba(0,0,0,0.65);
    display:flex;
    justify-content:center;
    align-items:center;
    flex-direction:column;
    animation:fadeIn 1s ease;
}

.certificate{
    background:white;
    color:#4a148c;
    padding:30px;
    border-radius:20px;
    width:90%;
    max-width:450px;
    text-align:center;
    box-shadow:0 10px 30px rgba(0,0,0,0.4);
}

.restart-btn{
    margin-top:20px;
    padding:15px 35px;
    font-size:1.4rem;
    background:#FFD700;
    color:#4a148c;
    border:none;
    border-radius:12px;
    cursor:pointer;
    font-weight:bold;
    transition:0.25s;
}

.restart-btn:hover{
    transform:scale(1.1);
}
</style>
<script>
/* ===========================
      الأصوات الرمضانية
=========================== */
const sndStart = new Audio("https://cdn.pixabay.com/download/audio/2022/03/15/audio_1c8d9e3b4d.mp3?filename=start-13693.mp3");
const sndEnd = new Audio("https://cdn.pixabay.com/download/audio/2022/03/15/audio_6d7f7dedf8.mp3?filename=finish-13693.mp3");
const sndCorrect = new Audio("https://cdn.pixabay.com/download/audio/2022/03/15/audio_7e8e9e3b4d.mp3?filename=correct-2-46134.mp3");
const sndWrong = new Audio("https://cdn.pixabay.com/download/audio/2022/03/15/audio_6d7f7dedf8.mp3?filename=error-2-46134.mp3");
const sndNext = new Audio("https://cdn.pixabay.com/download/audio/2022/03/15/audio_0e3b82466e.mp3?filename=click-124467.mp3");
const sndTimeUp = new Audio("https://cdn.pixabay.com/download/audio/2021/09/06/audio_4e0a1e3b4d.mp3?filename=drum-hit-1-100bpm-8801.mp3");

/* ===========================
      تحميل الأسئلة
=========================== */
let questions = [];

async function loadQuestions(){
    try {
        const res = await fetch("questions.json?nocache=" + Date.now());
        if (!res.ok) throw new Error("JSON not found");
        questions = await res.json();
    } catch (e) {
        alert("تعذر تحميل ملف الأسئلة. تأكد من وجود questions.json في نفس المجلد.");
        questions = [];
    }
}

/* ===========================
      المتغيرات الأساسية
=========================== */
let pos = 0;
let score = 0;
let username = "";
let timer = 20;
let timerInterval;

/* ===========================
      حفظ الاسم
=========================== */
function saveUsername(){
    const input = document.getElementById("usernameInput").value.trim();
    if(!input){
        alert("الرجاء إدخال الاسم");
        return;
    }
    username = input;

    document.getElementById("usernameScreen").style.display = "none";
    document.getElementById("startScreen").style.display = "flex";
}

/* ===========================
      بدء اللعبة
=========================== */
async function startGame(){
    sndStart.play();
    await loadQuestions();

    pos = 0;
    score = 0;

    document.getElementById("startScreen").style.display = "none";
    document.getElementById("gameCard").style.display = "block";

    render();
    startTimer();
}

/* ===========================
      المؤقّت
=========================== */
function startTimer(){
    timer = 20;
    document.getElementById("timer").textContent = timer;

    clearInterval(timerInterval);

    timerInterval = setInterval(()=>{
        timer--;
        document.getElementById("timer").textContent = timer;

        if(timer <= 0){
            clearInterval(timerInterval);
            sndTimeUp.play();
            handleTimeUp();
        }
    },1000);
}

function handleTimeUp(){
    // يعتبر السؤال خطأ
    feedback.textContent = "انتهى الوقت!";
    feedback.style.color = "#e74c3c";

    setTimeout(()=>{
        pos++;
        sndNext.play();
        render();
        startTimer();
    },900);
}

/* ===========================
      عرض السؤال
=========================== */
const qTxt = document.getElementById("q-txt");
const qnum = document.getElementById("qnum");
const scoreBox = document.getElementById("score");
const feedback = document.getElementById("feedback");

function render(){
    if(pos >= questions.length){
        return endGame();
    }

    const item = questions[pos];

    qTxt.textContent = item.q;
    qnum.textContent = pos + 1;
    feedback.textContent = "";

    // حركة ظهور السؤال
    qTxt.style.animation = "fadeIn 0.8s ease";
}

/* ===========================
      التحقق من الإجابة
=========================== */
document.getElementById("ok-btn").onclick = ()=>check(true);
document.getElementById("no-btn").onclick = ()=>check(false);

function check(val){
    clearInterval(timerInterval);

    const correct = questions[pos].a;

    if(val === correct){
        feedback.textContent = "إجابة صحيحة";
        feedback.style.color = "#2ecc71";
        score += 10;
        scoreBox.textContent = score;
        sndCorrect.play();
    }else{
        feedback.textContent = "إجابة خاطئة";
        feedback.style.color = "#e74c3c";
        sndWrong.play();
    }

    setTimeout(()=>{
        pos++;
        sndNext.play();
        render();
        startTimer();
    },900);
}

/* ===========================
      نهاية اللعبة
=========================== */
function endGame(){
    sndEnd.play();
    clearInterval(timerInterval);

    document.getElementById("gameCard").style.display = "none";
    document.getElementById("endScreen").style.display = "flex";

    document.getElementById("certName").textContent = username;
    document.getElementById("certScore").textContent = score;
    document.getElementById("certPercent").textContent = ((score/(questions.length*10))*100).toFixed(1);
}

/* ===========================
      إعادة اللعب
=========================== */
function restart(){
    pos = 0;
    score = 0;
    scoreBox.textContent = 0;

    document.getElementById("endScreen").style.display = "none";
    document.getElementById("startScreen").style.display = "flex";
}
</script>

</body>
</html>

